name: ğŸ“š Auto-Generate Educational Content

on:
  pull_request:
    paths:
      - 'content/calcbundle/**/contentConfig.json'

jobs:
  generate-educational-md:
    runs-on: ubuntu-latest
    steps:
      - name: â¬‡ï¸ Checkout repo
        uses: actions/checkout@v3

      - name: ğŸŸ¢ Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: ğŸ“¦ Install dependencies
        run: npm install

      - name: ğŸ”‘ Inject OpenAI key
        env:
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
        run: echo "KEY injected"

      - name: ğŸš€ Run content generator for each config file
        run: |
          for f in $(find content/calcbundle -name contentConfig.json); do
            slug=$(basename $(dirname "$f"))
            echo "Generating for $slug..."
            OPENAI_API_KEY=${{ secrets.OPENAI_API_KEY }} node scripts/generateEducationalContent.js $slug
          done

      - name: ğŸ“¤ Commit generated files
        run: |
          git config --global user.email "bot@calchub.com"
          git config --global user.name "CalcHub Bot"
          git add content/calculators/*.generated.en.md || true
          git commit -m "ğŸ¤– Auto-generated educational content" || echo "No changes"
          git push || true