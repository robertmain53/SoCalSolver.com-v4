name: üåç Auto Multilingual SEO Check

on:
  pull_request:
    branches: [main]
  push:
    branches: [main]

jobs:
  seo-lighthouse-multilang:
    runs-on: ubuntu-latest
    steps:
      - name: ‚¨áÔ∏è Checkout Repo
        uses: actions/checkout@v3

      - name: üü¢ Setup Node
        uses: actions/setup-node@v3
        with:
          node-version: 18

      - name: üì¶ Install Dependencies
        run: npm install

      - name: ‚öíÔ∏è Build Project
        run: npm run build

      - name: üß™ Detect Locales
        id: detect_locales
        run: |
          echo "LOCALES=$(jq -r '.i18n.locales[].code' nuxt.config.ts | paste -sd ',' -)" >> $GITHUB_ENV

      - name: üö¶ Run Lighthouse on All Locales
        run: |
          npm install -g @lhci/cli@0.12.x
          for locale in $(echo $LOCALES | tr "," "\n"); do
            echo "Running Lighthouse for: /$locale/calculators/compound-interest"
            lhci collect --url=http://localhost:3000/$locale/calculators/compound-interest --settings.preset=desktop --outputDir=.lighthouse/$locale || echo "‚ö†Ô∏è LHCI failed for $locale"
          done

      - name: üìä Structured Data Testing (SDTT)
        run: |
          npm install -g structured-data-testing-tool
          structured-data-testing-tool .output/public/**/calculators/*.html || echo "‚ö†Ô∏è SDTT issues"